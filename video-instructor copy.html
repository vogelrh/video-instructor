<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<!-- 
  `video-instructor` Provides detailed control and access to a video file. @demo demo/index.html 
  -->
<dom-module id="video-instructor">
  <template>
    <style>
       :host {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
        position: relative;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        border: 0;
        height: 100%;
        width: 100%;
        @apply --nebula-sidebar-layout;
      }

       :host([collapsed]) {
        @apply --nebula-sidebar-layout-collapsed;
      }

       :host([collapsed][opened]) {
        cursor: pointer;
        @apply --nebula-sidebar-layout-opened;
      }


      #content {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        -ms-flex: 1 1 auto;
        -webkit-flex: 1 1 auto;
        flex: 1 1 auto;
        cursor: default;
        margin: 0;
        padding: 0;
        border: 0;
        outline: 0;
        overflow: hidden;
        overflow-y: auto;
        @apply --nebula-sidebar-layout-content;
      }

      #content:after {
        content: '';
        position: fixed;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        margin: 0;
        padding: 0;
        border: 0;
        background-color: var(--nebula-sidebar-layout-backdrop-color, var(--nebula-ui-backdrop-color, hsla(0, 0%, 0%, 0.6)));
        visibility: hidden;
        opacity: 0;
        transition: opacity var(--nebula-sidebar-layout-transition-duration, 0.25s) linear, visibility 0s linear var(--nebula-sidebar-layout-transition-duration, 0.25s);
        @apply --nebula-sidebar-layout-backdrop;
      }

       :host([collapsed][opened]) #content:after {
        visibility: visible;
        opacity: 1;
        transition: opacity var(--nebula-sidebar-layout-transition-duration, 0.25s) linear;
        @apply --nebula-sidebar-layout-opened-backdrop;
      }

      #sidebar {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        -ms-flex: none;
        -webkit-flex: none;
        flex: none;
        cursor: default;
        margin: 0;
        padding: 0;
        border: 0;
        outline: 0;
        overflow: hidden;
        overflow-y: auto;
        width: fit-content;
        transform: translate3d(0, 0, 0);
        transition: transform var(--nebula-sidebar-layout-transition-duration, 0.25s) ease;
        @apply --nebula-sidebar-layout-sidebar;
      }
      #sidebar div paper-toolbar {
        --paper-toolbar-background: grey;
      }

       :host([collapsed]) #sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        visibility: hidden;
        transform: translate3d(-100%, 0, 0);
        transition: transform var(--nebula-sidebar-layout-transition-duration, 0.25s) ease, visibility 0s linear var(--nebula-sidebar-layout-transition-duration, 0.25s);
        @apply --nebula-sidebar-layout-collapsed-sidebar;
      }

       :host([collapsed][opened]) #sidebar {
        z-index: 9998;
        visibility: visible;
        transform: translate3d(0, 0, 0);
        transition: transform var(--nebula-sidebar-layout-transition-duration, 0.25s) ease;
        @apply --nebula-sidebar-layout-opened-sidebar;
      }
    </style>
    <div id="sidbar" >
      <paper-toolbar>
        <span slot="top" class="title">Content</span>
      </paper-toolbar>
      <div class="controls" role="listbox">
        <template is="dom-repeat" items="{{chapters}}">
          <paper-item id="ch_[[index]]" on-tap="goToChapter">[[_addOne(index)]] [[item.text]] </paper-item>
        </template>
      </div>
    </div>
    <div id="content" inert$="{{opened}}" tabindex="-1">
      <paper-toolbar>
        <span slot="top" class="title">Video  {{_curTime}} / {{_duration}}</span>
      </paper-toolbar>
      <div>
        <video id="vtag" src=[[source]] controls>Video not supported</video>
      </div>
    </div>
  </template>

  <script>
    class MyElement extends Polymer.Element {
      static get is() {
        return 'video-instructor';
      }
      static get properties() {
        return {
          source: {
            type: String,
            value: ''
          },
          chapters: {
            type: Array,
            value() {
              return [{
                  text: 'Start Carry Tiger',
                  time: 0
                },
                {
                  text: 'Rollback',
                  time: 30
                },
                {
                  text: 'Grasp Birds tail',
                  time: 37
                },
                {
                  text: 'Roll-back, Press & Push',
                  time: 46
                },
                {
                  text: 'Single Wip',
                  time: 72
                },
                {
                  text: 'Transistion',
                  time: 96
                },
                {
                  text: 'Whip to Fist Under Elbow',
                  time: 113
                },
                {
                  text: 'Repulse Monkey',
                  time: 119
                },
                {
                  text: 'Transition',
                  time: 178
                },
                {
                  text: 'Slant Hands Flying',
                  time: 183.5
                },
                {
                  text: 'Lifting Hands',
                  time: 195.6
                },
                {
                  text: 'White Crane Spreads Wings',
                  time: 210
                },
                {
                  text: 'Brush Knee Left',
                  time: 226.5
                },
                {
                  text: 'Pick Up Needle',
                  time: 240.5
                }
              ];
            }
          },
          _curTime: {
            type: Number,
            value: 0,
            readOnly: true,
            notify: true
          },
          _duration: {
            type: Number,
            value: 0,
            readOnly: true,
            notify: true
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
        this.$.vtag.addEventListener("timeupdate",  () => {
          this._set_curTime(this.$.vtag.currentTime);
          console.log(this.$.vtag.currentTime);
        });
        this.$.vtag.addEventListener("loadeddata",  () => {
          this._set_duration(this.$.vtag.duration);
          console.log(`Video loaded, duration: ${this.$.vtag.duration}`)
        });

      }
      goToChapter(e) {
        try {
          let ctix = parseInt(e.srcElement.id.split('_')[1]);
          this.$.vtag.currentTime = this.chapters[ctix].time;
          console.log(`Chapter Time: ${e.srcElement.id}`);
        } catch (err) {
          console.error(err);
        }
      }

      _addOne(index) {
        return index + 1;
      }
    }

    window.customElements.define(MyElement.is, MyElement);
  </script>
</dom-module>